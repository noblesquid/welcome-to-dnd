<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>D&D Invitation</title>

<link href="https://fonts.googleapis.com/css2?family=IM+Fell+English&display=swap" rel="stylesheet">

<style>
:root{
  --bg-dark:#0d0f12;
  --muted:#d0d4d8;
  --accent:#ffd8a0;
  --parchment:#f6e7b2;
  --parchment-ink:#3b2f1f;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{
  height:100%;
  background:var(--bg-dark);
  font-family:"IM Fell English",serif;
  color:var(--muted);
  overflow:hidden;
}
.hidden{display:none!important}

.scene{
  width:min(900px,92vw);
  height:min(560px,78vh);
  margin:auto;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  opacity:0;
  transition:.6s ease;
}
.scene.visible{opacity:1}

.plain-center{
  font-size:1rem;
  text-align:center;
}

.typewriter{
  border-right:2px solid rgba(255,255,255,.4);
  animation:caret .9s steps(1) infinite;
}
@keyframes caret{50%{border-color:transparent}}

.continue{
  position:absolute;
  bottom:20px;
  font-size:.85rem;
  opacity:0;
  animation:pulse 1.2s infinite;
}
.continue.visible{opacity:1}
@keyframes pulse{50%{opacity:.4}}

#start-screen{
  position:fixed;inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
}
#start-screen button{
  font-size:1.4rem;
  padding:16px 32px;
  border-radius:12px;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="start-screen">
  <button id="start-btn">Start your quest</button>
</div>

<audio id="bgm" src="sound/bgm.wav" loop></audio>
<audio id="knock-sfx" src="sound/knock-sfx.mp3"></audio>
<audio id="steps-sfx" src="sound/steps-sfx.mp3"></audio>

<div id="overlay" class="scene">
  <div id="visual" class="plain-center"></div>
  <div id="continue" class="continue">â–¼ Click to continue â–¼</div>
</div>

<script>
(() => {
  const startBtn = document.getElementById('start-btn');
  const startScreen = document.getElementById('start-screen');
  const overlay = document.getElementById('overlay');
  const visual = document.getElementById('visual');
  const continueEl = document.getElementById('continue');

  const bgm = document.getElementById('bgm');
  const knockSfx = document.getElementById('knock-sfx');
  const stepsSfx = document.getElementById('steps-sfx');

  let scene = 0;
  let typingTimer = null;

  /* ================= TYPEWRITER (with progress) ================= */

  function startTypewriter(
    text,
    el,
    speed = 40,
    onComplete = null,
    onProgress = null
  ) {
    el.textContent = '';
    el.classList.add('typewriter');
    let i = 0;

    function step() {
      el.textContent += text[i++];
      if (onProgress) onProgress(i / text.length);

      if (i >= text.length) {
        el.classList.remove('typewriter');
        if (onComplete) onComplete();
        return;
      }
      typingTimer = setTimeout(step, speed);
    }
    step();
  }

  function showContinue() {
    continueEl.classList.add('visible');
  }
  function hideContinue() {
    continueEl.classList.remove('visible');
  }

  /* ================= SCENES ================= */

  function scene0() {
    knockSfx.play();
    visual.textContent = "Someone knocks on your door...";
    showContinue();
  }

  function scene6() {
    hideContinue();
    visual.innerHTML = `<span id="leave-text"></span>`;
    const el = document.getElementById('leave-text');

    stepsSfx.currentTime = 0;
    stepsSfx.volume = 1;
    stepsSfx.play();

    startTypewriter(
      "The strange person leaves...",
      el,
      45,
      () => {
        stepsSfx.pause();
        stepsSfx.currentTime = 0;
        showContinue();
      },
      (progress) => {
        // ðŸ”¥ FOOTSTEPS FADE BASED ON TEXT PROGRESS
        stepsSfx.volume = Math.max(0, 1 - progress);
      }
    );
  }

  /* ================= CONTROLS ================= */

  function advance() {
    switch(scene){
      case 0: scene=6; scene6(); break;
      case 6: overlay.style.opacity=0; break;
    }
  }

  overlay.addEventListener('click', advance);
  document.addEventListener('keydown', e=>{
    if(e.key==='Enter'||e.key===' ') advance();
  });

  startBtn.onclick = () => {
    startScreen.style.display='none';
    overlay.classList.add('visible');
    bgm.volume=.3;
    bgm.play();
    scene0();
  };
})();
</script>

</body>
</html>
