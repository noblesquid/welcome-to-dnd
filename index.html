<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>D&amp;D Invitation â€” Enhanced</title>

<link href="https://fonts.googleapis.com/css2?family=IM+Fell+English&display=swap" rel="stylesheet">

<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UNCHANGED CSS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root{
  --bg-dark:#0d0f12;
  --muted:#d0d4d8;
  --accent:#ffd8a0;
  --parchment:#f6e7b2;
  --parchment-ink:#3b2f1f;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{
  height:100%;width:100%;background:var(--bg-dark);
  font-family:"IM Fell English",serif;color:var(--muted);overflow:hidden;
}
.hidden{display:none!important}
.typewriter{
  border-right:2px solid rgba(60,40,20,0.6);
  animation:caret .9s steps(1) infinite;
}
@keyframes caret{50%{border-right-color:transparent}}
/* (rest of your CSS remains exactly as-is) */
</style>
</head>

<body>

<!-- Start screen -->
<div id="start-screen">
  <button id="start-btn">Start your quest</button>
</div>

<!-- Audio -->
<audio id="bgm" src="sound/bgm.wav" loop preload="auto" muted></audio>
<audio id="knock-sfx" src="sound/knock-sfx.mp3" preload="auto"></audio>
<audio id="paper-sfx" src="sound/ping-sfx.mp3" preload="auto"></audio>
<audio id="ping-sfx" src="sound/ping-sfx.mp3" preload="auto"></audio>
<audio id="thunder-sfx" src="sound/thunder-sfx.mp3" preload="auto"></audio>

<!-- ðŸ”¥ FOOTSTEPS â€” loop REMOVED -->
<audio id="steps-sfx" src="sound/steps-sfx.mp3" preload="auto"></audio>

<div id="inv-overlay" class="overlay" style="display:none;">
  <div id="scene" class="scene">
    <div class="visual-wrap">
      <div id="visual" class="visual fade-in"></div>
    </div>
    <div id="continue" class="continue hidden">â–¼ Click to continue â–¼</div>
  </div>
</div>

<script>
(() => {

  const visual = document.getElementById('visual');
  const continueEl = document.getElementById('continue');
  const overlay = document.getElementById('inv-overlay');
  const sceneEl = document.getElementById('scene');

  const bgm = document.getElementById("bgm");
  const knockSfx = document.getElementById("knock-sfx");
  const paperSfx = document.getElementById("paper-sfx");
  const pingSfx = document.getElementById("ping-sfx");
  const thunderSfx = document.getElementById("thunder-sfx");
  const stepsSfx = document.getElementById("steps-sfx");

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ORIGINAL VOLUME SECTION (UNCHANGED) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  bgm.volume = 0.30;
  knockSfx.volume = 0.40;
  paperSfx.volume = 0.15;
  pingSfx.volume = 0.15;
  thunderSfx.volume = 0.60;
  stepsSfx.volume = 0.2;

  let scene = 0;
  let typingTimer = null;

  function clearTyping(showFull = true) {
    if (typingTimer) {
      clearTimeout(typingTimer.timeoutId);
      if (showFull && typingTimer.finishText && typingTimer.el) {
        typingTimer.el.textContent = typingTimer.finishText;
      }
      typingTimer = null;
    }
    document.querySelectorAll('.typewriter')
      .forEach(e => e.classList.remove('typewriter'));
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TYPEWRITER (ENHANCED WITH PROGRESS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function startTypewriter(
    text,
    el,
    baseSpeed = 35,
    onComplete = null,
    onProgress = null
  ) {
    clearTyping(false);
    el.textContent = '';
    el.classList.add('typewriter');
    let i = 0;
    const total = text.length;

    function step() {
      el.textContent += text[i] || '';
      i++;

      if (typeof onProgress === 'function') {
        onProgress(i / total); // 0 â†’ 1
      }

      if (i >= total) {
        el.classList.remove('typewriter');
        typingTimer = null;
        if (onComplete) onComplete();
        return;
      }

      let delay = baseSpeed;
      const lastChar = text[i - 1];
      if (lastChar === '.' || lastChar === ',') delay *= 2;

      typingTimer = {
        el,
        finishText: text,
        timeoutId: setTimeout(step, delay)
      };
    }

    typingTimer = {
      el,
      finishText: text,
      timeoutId: setTimeout(step, baseSpeed)
    };
  }

  function showContinueBelow() {
    continueEl.classList.remove('hidden');
  }

  function hideContinue() {
    continueEl.classList.add('hidden');
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCENE 6 (ONLY MODIFIED SCENE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function scene6() {
    visual.innerHTML = `<div class="plain-center"><span id="leave-text"></span></div>`;
    const el = document.getElementById('leave-text');

    stepsSfx.currentTime = 0;
    stepsSfx.loop = false;
    stepsSfx.volume = 0.5;
    stepsSfx.play().catch(() => {});

    startTypewriter(
      "The strange person leaves...",
      el,
      48,
      () => {
        stepsSfx.pause();
        stepsSfx.currentTime = 0;
        showContinueBelow();
      },
      (progress) => {
        // ðŸ”¥ Footsteps fade with text progress
        stepsSfx.volume = Math.max(0, 0.5 * (1 - progress));
      }
    );
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BASIC FLOW (UNCHANGED STRUCTURE) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  function handleAdvance() {
    if (typingTimer) { clearTyping(true); return; }
    if (scene === 0) { scene = 6; scene6(); }
    else overlay.remove();
  }

  overlay.addEventListener('click', handleAdvance);
  document.addEventListener('keydown', e => {
    if (e.key === 'Enter' || e.key === ' ') handleAdvance();
  });

  document.getElementById('start-btn').onclick = () => {
    document.getElementById('start-screen').style.display = 'none';
    overlay.style.display = 'flex';
    bgm.play().catch(()=>{});
    scene = 0;
    visual.textContent = "Someone knocks on your door...";
    showContinueBelow();
  };

})();
</script>

</body>
</html>
